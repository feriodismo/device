<!DOCTYPE html>
<html>
<head>
	<title>Ubicacion del Cel</title>
</head>
<body>
<div class="visibilidad"></div>
<div class="visibilidad2"></div>
<strong>geolocation</strong>
<p class="comentario"></p>

<script>
  var comentario = document.querySelector('.comentario')
  var visibilidad = document.querySelector('.visibilidad')
  var visibilidad2 = document.querySelector('.visibilidad2')
  window.addEventListener('deviceorientation', deviceOrientationHandler, false);
  function deviceOrientationHandler(e){
  	var beta = Math.round(e.beta)
  	var gamma = Math.round(e.gamma)
  	var alpha = Math.round(e.alpha)
  		visibilidad.innerHTML = 'alpha:'+alpha+'<br> beta:'+beta+'<br> gamma:'+gamma+'<br><br>'
  		console.log(e);
  }


var lonf1;
var lonf2;
var latf1;
var latf2;
var momento = 0;
 window.addEventListener('click', ejemplo);
var contador = 0;


function ejemplo(){
	momento++;
		if(momento === 1){
			console.log(momento)
  var startPos;
  var geoSuccess = function(position) {
  	contador++;

    startPos = position;
    comentario.innerHTML = startPos.coords.latitude + '<br>' + startPos.coords.longitude +'<br>' + contador;
  	lonf1 = startPos.coords.longitude;
  	latf1 = startPos.coords.latitude;
  };
  var geoError = function(error) {
    console.log('Error occurred. Error code: ' + error.code);
    // error.code can be:
    //   0: unknown error
    //   1: permission denied
    //   2: position unavailable (error response from location provider)
    //   3: timed out
  };
  navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
}
		
else if(momento === 2){
	console.log(momento)
	  var startPos;
  var geoSuccess = function(position) {
  	contador++;

    startPos = position;
    comentario.innerHTML = startPos.coords.latitude + '<br>' + startPos.coords.longitude +'<br>' + contador;
  	lonf2 = startPos.coords.longitude;
  	latf2 = startPos.coords.latitude;
  };
}
  else if(momento === 3){
  	console.log(momento)
  	measure(latf1, lonf1, latf2, lonf2);
  }

}


function measure(lat1, lon1, lat2, lon2){  // generally used geo measurement function
    var R = 6378.137; // Radius of earth in KM
    var dLat = lat2 * Math.PI / 180 - lat1 * Math.PI / 180;
    var dLon = lon2 * Math.PI / 180 - lon1 * Math.PI / 180;
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c;
    	comentario.innerHTML = d*1000;
    console.log(d * 1000);
    return d * 1000; // meters

}

</script>
</body>
</html>